

##  - name: Exporting proxy
##    command: vzctl exec 1002 export http_proxy="http://proxy.iiit.ac.in:8080" && vzctl exec 1002 export https_proxy="http://proxy.iiit.ac.in:8080" && vzctl exec 1002 yum install openssh -y
##    register: out
##  - debug: var=out.stdout_lines
# - lineinfile:
#     path: /vz/private/1002/etc/yum.conf
#     regexp: '^proxy=http://'
#     line: 'proxy={{ proxy_env.http_proxy }}'
# - replace:
 #    path: /vz/private/1002/etc/yum.conf
 #    regexp: '^proxy=.*'
 #    replace: 'proxy'
  # - name: Check proxy
  #   shell: echo {{proxy_env}}
  #   register: out
  # - debug:
  #    var:  out  
#- include: test.yml
#- name: installing openssh
 # command: vzctl exec 1002 export http_proxy="{{proxy_env.http_proxy}}" && export https_proxy="{{proxy_env.https_proxy}}" && yum install "{{item}}" -y && service sshd start &&  chkconfig sshd on  
 # command: vzctl exec 1002 {{export_proxy}} && yum install "{{item}}" -y && service sshd start && chkconfig sshd on
 # register: out  
#  with_items:
   #       - openssh-server
 #         - openssh-clients  
  #        - openssh
#- debug: 
  #   var: out
#- include: installansible.yml
#- include: path.yml
#- include: runplay.yml
    
# - name: installing ansible
#   yum: name="{{item}}" state=latest
#   environment: "{{proxy_env}}"
#   with_items:
#        - epel-release
#        - ansible
#        - git
 - name: Create vlead user and generate ssh-keys for vlead
   user: name=vlead password={{vlead_user_password}} generate_ssh_key=yes groups=wheel
 - name: Replacing wheel
   lineinfile: 
       path: /etc/sudoers 
       regexp: '^%wheel.*NOPASSWD: ALL.*'  
       line: '%wheel        ALL=(ALL)       NOPASSWD: ALL' 
       state: present
 - name: Set StrictHostkeyChecking to no
   lineinfile: path=/etc/ssh/ssh_config regexp="^Strict.*" line="StrictHostKeyChecking no" state=present
   notify: restart_ssh
 - name: Set PermitRootLogin to yes
   lineinfile: path=/etc/ssh/sshd_config regexp="^PermitRoot.*" line="PermitRootLogin yes" state=present
   notify: restart_ssh

 - name: Set PermitRootLogin to yes
   lineinfile: path=/etc/ssh/sshd_config regexp="^PasswordAuthentication.*" line="PasswordAuthentication yes" state=present
   notify: restart_ssh

# - name: Strict Host key check no
#   copy: src=ssh-config dest=~/.ssh/ mode=400
